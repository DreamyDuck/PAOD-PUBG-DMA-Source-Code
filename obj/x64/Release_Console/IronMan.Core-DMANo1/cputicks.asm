; Listing generated by Microsoft (R) Optimizing Compiler Version 19.43.34810.0 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?now@CpuTicks@asmjit@@SAIXZ			; asmjit::CpuTicks::now
PUBLIC	__real@408f400000000000
EXTRN	__imp_QueryPerformanceCounter:PROC
EXTRN	__imp_QueryPerformanceFrequency:PROC
EXTRN	__imp_GetTickCount:PROC
EXTRN	_fltused:DWORD
_BSS	SEGMENT
?CpuTicks_hiResOk@asmjit@@3IC DD 01H DUP (?)		; asmjit::CpuTicks_hiResOk
	ALIGN	8

?CpuTicks_hiResFreq@asmjit@@3NC DQ 01H DUP (?)		; asmjit::CpuTicks_hiResFreq
_BSS	ENDS
pdata	SEGMENT
$pdata$?now@CpuTicks@asmjit@@SAIXZ DD imagerel $LN11
	DD	imagerel $LN11+280
	DD	imagerel $unwind$?now@CpuTicks@asmjit@@SAIXZ
pdata	ENDS
;	COMDAT __real@408f400000000000
CONST	SEGMENT
__real@408f400000000000 DQ 0408f400000000000r	; 1000
CONST	ENDS
voltbl	SEGMENT
_volmd	DD	0ffffffffH
	DDSymXIndex: 	FLAT:?now@CpuTicks@asmjit@@SAIXZ
	DD	04H
	DD	030H
	DD	076H
	DD	0a4H
	DD	0c5H
	DD	0e3H
voltbl	ENDS
xdata	SEGMENT
$unwind$?now@CpuTicks@asmjit@@SAIXZ DD 010401H
	DD	0a204H
xdata	ENDS
; Function compile flags: /Odtp
; File D:\c++\paoda\ThirdParty\AsmJit\base\cputicks.cpp
_TEXT	SEGMENT
hiResOk$1 = 32
tv142 = 36
tv137 = 40
tv134 = 44
freqDouble$2 = 48
now$3 = 56
qpf$4 = 64
now$5 = 72
?now@CpuTicks@asmjit@@SAIXZ PROC			; asmjit::CpuTicks::now

; 48   : uint32_t CpuTicks::now() {

$LN11:
	sub	rsp, 88					; 00000058H
$LN4@now:

; 49   :   do {
; 50   :     uint32_t hiResOk = CpuTicks_hiResOk;

	mov	eax, DWORD PTR ?CpuTicks_hiResOk@asmjit@@3IC
	mov	DWORD PTR hiResOk$1[rsp], eax

; 51   : 
; 52   :     if (hiResOk == 1) {

	cmp	DWORD PTR hiResOk$1[rsp], 1
	jne	SHORT $LN5@now

; 53   :       LARGE_INTEGER now;
; 54   :       if (!::QueryPerformanceCounter(&now))

	lea	rcx, QWORD PTR now$3[rsp]
	call	QWORD PTR __imp_QueryPerformanceCounter
	test	eax, eax
	jne	SHORT $LN6@now

; 55   :         break;

	jmp	$LN3@now
$LN6@now:

; 56   :       return (int64_t)(double(now.QuadPart) / CpuTicks_hiResFreq);

	cvtsi2sd xmm0, QWORD PTR now$3[rsp]
	movsd	xmm1, QWORD PTR ?CpuTicks_hiResFreq@asmjit@@3NC
	divsd	xmm0, xmm1
	cvttsd2si rax, xmm0
	jmp	$LN1@now
$LN5@now:

; 57   :     }
; 58   : 
; 59   :     if (hiResOk == 0) {

	cmp	DWORD PTR hiResOk$1[rsp], 0
	jne	$LN7@now

; 60   :       LARGE_INTEGER qpf;
; 61   :       if (!::QueryPerformanceFrequency(&qpf)) {

	lea	rcx, QWORD PTR qpf$4[rsp]
	call	QWORD PTR __imp_QueryPerformanceFrequency
	test	eax, eax
	jne	SHORT $LN8@now

; 62   :         _InterlockedCompareExchange((LONG*)&CpuTicks_hiResOk, 0xFFFFFFFF, 0);

	mov	eax, -1
	mov	DWORD PTR tv142[rsp], eax
	lea	rcx, OFFSET FLAT:?CpuTicks_hiResOk@asmjit@@3IC
	xor	eax, eax
	mov	edx, DWORD PTR tv142[rsp]
	lock cmpxchg DWORD PTR [rcx], edx

; 63   :         break;

	jmp	$LN3@now
$LN8@now:

; 64   :       }
; 65   : 
; 66   :       LARGE_INTEGER now;
; 67   :       if (!::QueryPerformanceCounter(&now)) {

	lea	rcx, QWORD PTR now$5[rsp]
	call	QWORD PTR __imp_QueryPerformanceCounter
	test	eax, eax
	jne	SHORT $LN9@now

; 68   :         _InterlockedCompareExchange((LONG*)&CpuTicks_hiResOk, 0xFFFFFFFF, 0);

	mov	eax, -1
	mov	DWORD PTR tv137[rsp], eax
	lea	rcx, OFFSET FLAT:?CpuTicks_hiResOk@asmjit@@3IC
	xor	eax, eax
	mov	edx, DWORD PTR tv137[rsp]
	lock cmpxchg DWORD PTR [rcx], edx

; 69   :         break;

	jmp	SHORT $LN3@now
$LN9@now:

; 70   :       }
; 71   : 
; 72   :       double freqDouble = double(qpf.QuadPart) / 1000.0;

	cvtsi2sd xmm0, QWORD PTR qpf$4[rsp]
	divsd	xmm0, QWORD PTR __real@408f400000000000
	movsd	QWORD PTR freqDouble$2[rsp], xmm0

; 73   : 
; 74   :       CpuTicks_hiResFreq = freqDouble;

	movsd	xmm0, QWORD PTR freqDouble$2[rsp]
	movsd	QWORD PTR ?CpuTicks_hiResFreq@asmjit@@3NC, xmm0

; 75   :       _InterlockedCompareExchange((LONG*)&CpuTicks_hiResOk, 1, 0);

	mov	eax, 1
	mov	DWORD PTR tv134[rsp], eax
	lea	rcx, OFFSET FLAT:?CpuTicks_hiResOk@asmjit@@3IC
	xor	eax, eax
	mov	edx, DWORD PTR tv134[rsp]
	lock cmpxchg DWORD PTR [rcx], edx

; 76   : 
; 77   :       return static_cast<uint32_t>(

	cvtsi2sd xmm0, QWORD PTR now$5[rsp]
	divsd	xmm0, QWORD PTR freqDouble$2[rsp]
	cvttsd2si rax, xmm0
	mov	ecx, -1
	and	rax, rcx
	jmp	SHORT $LN1@now
$LN7@now:

; 78   :         static_cast<int64_t>(double(now.QuadPart) / freqDouble) & 0xFFFFFFFF);
; 79   :     }
; 80   :   } while (0);

	xor	eax, eax
	test	eax, eax
	jne	$LN4@now
$LN3@now:

; 81   : 
; 82   :   // Bail to a less precise GetTickCount().
; 83   :   return ::GetTickCount();

	call	QWORD PTR __imp_GetTickCount
$LN1@now:

; 84   : }

	add	rsp, 88					; 00000058H
	ret	0
?now@CpuTicks@asmjit@@SAIXZ ENDP			; asmjit::CpuTicks::now
_TEXT	ENDS
END
